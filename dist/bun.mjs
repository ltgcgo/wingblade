var $=Object.defineProperty;var y=(e,t,r)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var s=(e,t,r)=>(y(e,typeof t!="symbol"?t+"":t,r),r);var c,f=(c=class{static get memUsed(){return{rss:0,heapTotal:0,heapUsed:0,external:0}}static exit(e=0){process.exit(e)}},s(c,"os",process.platform),s(c,"variant","Bun"),s(c,"version",Bun.version),s(c,"persist",!0),s(c,"networkDefer",!1),c),p="delete,get,has,set,toObject".split(","),w=new Proxy({get:(e,t)=>Bun.env[e]||t,set:(e,t)=>{Bun.env[e]=t},delete:e=>{delete Bun.env[e]},has:e=>!!Bun.env[e],toObject:()=>Bun.env},{get:(e,t)=>p.indexOf(t)<0&&t.constructor==String?e.get(t):e[t],set:(e,t,r)=>{if(p.indexOf(t)<0)if(t.constructor==String)e.set(t,r);else throw new TypeError("Invalid type for key");else throw new Error("Tried to write protected properties")},has:(e,t)=>p.indexOf(t)<0?t.constructor==String?e.has(t):e[t]!=null:!1,deleteProperty:(e,t)=>{if(p.indexOf(t)<0)if(t.constructor==String)e.delete(t);else throw new TypeError("Invalid type for key");else throw new Error("Tried to delete protected properties")}});var T=class{static async read(e,t){return new Uint8Array(await Bun.file(e).arrayBuffer())}static async write(e,t,r){await Bun.write(e,t)}},h=T;var O=class{},m=O;var v='<!DOCTYPE html><head><meta charset="utf-8"/><title>WingBlade error</title><style>body{background:#000;color:#ccc;}</style></head><body><div style="width:75vw;min-width:360px;max-width:1080px;margin:0 auto;"><p>WingBlade has encountered an error on ${runtime}.</p><pre>${stackTrace}</pre></div></body>\n';var P=class{static serve(e,t={}){let r=`${process.cwd()}`,d=t.port||8e3,u=t.hostname||"0.0.0.0",B=Bun.serve({port:d,hostname:u,fetch:async(n,i)=>{n.socket=i;try{let a=await e(n);return a?.constructor!=Response&&(a=new Response(JSON.stringify(a),{headers:{"Content-Type":"application/json"}})),a}catch(a){let l=a.stack.split(`
`);return l.forEach((b,E,S)=>{S[E]=b.replace("@"," at ").replace("[native code]","bun:internal")}),l.unshift(`${a.name||"Error"}${a.message?":":""} ${a.message||""}`),l=l.join(`
    `),console.error(`Request error at ${n.method} ${n.url}
${l}`),new Response(v.replace("${runtime}",WingBlade.rt.variant).replace("${stackTrace}",l.replaceAll(r,"wingblade:app")),{status:502,headers:{"Content-Type":"text/html"}})}},websocket:{open(n){let i=n.data.wsServer;i.attach(n),i.dispatchEvent(new Event("open"))},message(n,i){n.data.wsServer.dispatchEvent(new MessageEvent("message",{data:i}))},close(n,i,a){n.data.wsServer.dispatchEvent(new Event("close"))}}});return console.error(`WingBlade serving at http://${u=="0.0.0.0"?"127.0.0.1":u}:${d}`),B}static acceptWs(e,t){let r=new WebSocketServer(e);return e.socket.upgrade(e,{data:{wsServer:r}}),{socket:r,response:new Response(null,{status:200})}}},g=P;var M=class{static randomInt(e){return Math.floor(Math.random()*e)}static sleep(e,t=0){return new Promise(r=>{AbortSignal.timeout(e+Math.floor(t*Math.random())).addEventListener("abort",()=>{r()})})}},x=M;var o,X=(o=class{},s(o,"args",Bun.argv.slice(2)),s(o,"rt",f),s(o,"env",w),s(o,"file",h),s(o,"net",m),s(o,"web",g),s(o,"util",x),o);export{X as WingBlade};
